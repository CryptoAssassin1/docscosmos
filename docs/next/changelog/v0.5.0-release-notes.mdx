---
title: "v0.5.0 Release Notes"
description: "Major release featuring EIP-2935, performance optimizations, and comprehensive compatibility testing"
---

Cosmos EVM v0.5.0 represents a significant milestone with major EVM compatibility improvements, performance optimizations, and enhanced developer tooling. This release includes breaking changes that require careful migration planning.

##  Breaking Changes

<Warning>
**Migration Required**

This release contains breaking changes to precompile interfaces, VM parameters, and mempool architecture. See the [Migration Guide](../documentation/integration/migration-v0.4-to-v0.5) for complete upgrade instructions.
</Warning>

### VM Module Parameters

- **REMOVED:** `allow_unprotected_txs` parameter from consensus
  - **Migration:** Now configured per-node in `app.toml` under `[json-rpc].allow-unprotected-txs`
  - **Impact:** Genesis files must be updated to remove this parameter

- **ADDED:** `history_serve_window` parameter for EIP-2935
  - **Default:** `8192` blocks
  - **Purpose:** Controls historical block hash storage depth

### Precompile Interface Changes

- **Breaking:** All precompile constructors now require keeper interfaces instead of concrete types
- **Impact:** Custom precompiles must cast keepers to interfaces: `common.BankKeeper(bankKeeper)`
- **Benefit:** Better decoupling and improved testability

### Mempool Architecture

- **Breaking:** Configuration-based approach replaces pre-built pools
- **Migration:** Replace `TxPool` and `CosmosPool` fields with `LegacyPoolConfig` and `CosmosPoolConfig`
- **Benefit:** Full configurability of transaction pool behavior

### Global Mempool Removal

- **Breaking:** Singleton pattern eliminated from mempool registry
- **Migration:** Pass mempool directly to JSON-RPC server instead of using global access
- **Impact:** Applications using `mempool.GetGlobalEVMMempool()` must be updated

---

##  New Features

### EIP-2935: Historical Block Hash Storage

**Full EIP-2935 Implementation** enables reliable access to historical block hashes:

- **BLOCKHASH Opcode Enhancement:** Access up to 8192 historical block hashes (configurable)
- **Smart Contract Compatibility:** Works seamlessly with existing `blockhash()` calls
- **Verifiable Randomness:** Enables protocols requiring historical entropy
- **Storage Control:** Configurable `history_serve_window` parameter

```solidity
// Smart contracts can now access extended block history
contract RandomnessProtocol {
    function getHistoricalHash(uint256 blockNumber) public view returns (bytes32) {
        return blockhash(blockNumber); // Works for last 8192 blocks
    }
}
```

### eth_createAccessList RPC Method

**New JSON-RPC Method** for transaction optimization:

- **Access List Generation:** Automatically identify storage access patterns
- **Gas Optimization:** Reduce transaction costs through precomputed access lists
- **Developer Tools:** Seamless integration with Ethereum development workflows

```bash
# Generate access list for gas optimization
curl -X POST -H "Content-Type: application/json" \
  --data '{
    "jsonrpc":"2.0",
    "method":"eth_createAccessList",
    "params":[{
      "to":"0x...",
      "data":"0x..."
    }, "latest"],
    "id":1
  }' http://localhost:8545
```

### Comprehensive Compatibility Testing

**5 New Testing Frameworks** ensure seamless tool compatibility:

- **Foundry Compatibility:** Full Foundry test suite with gas estimation validation
- **Hardhat Integration:** Complete Hardhat + Ethers.js compatibility testing
- **Viem TypeScript:** Modern TypeScript client compatibility validation
- **Web3.js Legacy:** Backward compatibility with legacy Web3.js applications  
- **DeFi Protocol Testing:** Complex Uniswap V3 deployment and interaction testing

**JSON-RPC Compliance Testing:**
- **evmd vs geth Comparison:** Automated testing comparing responses
- **Docker-based Environment:** Isolated testing with both clients
- **Comprehensive Coverage:** Transaction processing, queries, and gas estimation

---

##  Performance Improvements

### Gas Estimation Optimization

**90% Faster Estimation** for simple transfers:

- **Plain Transfer Detection:** Simple ETH transfers return 21000 gas immediately
- **Optimistic Bounds:** Complex transactions use execution results for better initial bounds  
- **Smart Binary Search:** Reduced iterations through intelligent bound calculation

**Performance Benchmarks:**
| Transaction Type | v0.4.x | v0.5.0 | Improvement |
|------------------|--------|--------|-------------|
| Simple Transfer | ~50ms | ~5ms | **90% faster** |
| Contract Call | ~100ms | ~60ms | **40% faster** |
| Contract Deploy | ~200ms | ~140ms | **30% faster** |

### State Management Optimization

**EVM Instance Reduction:**
- **Ante Handler Optimization:** Eliminated unnecessary EVM instance creation during balance checks
- **Memory Efficiency:** 50-70% faster balance validation
- **CPU Optimization:** Reduced computational overhead per transaction

### Mempool Enhancements

**Configurable Performance Tuning:**
- **Pool Size Control:** Customize transaction capacity per chain requirements
- **Priority Functions:** Implement custom transaction ordering logic
- **Broadcast Control:** Custom transaction propagation strategies
- **Lifetime Management:** Configurable transaction retention and eviction

---

##  Developer Experience

### Enhanced Transaction Responses

**New Fields Added:**
- **`max_used_gas`:** Gas consumed before refunds for better analytics
- **`block_timestamp`:** Block timestamp in log entries for improved debugging

### Improved Error Handling

- **Better Error Propagation:** Enhanced error messages throughout RPC stack
- **PostTxProcessing:** Now runs on transaction failures, preserving debug data
- **Revert Error Testing:** Comprehensive E2E tests for contract and precompile reverts

### Tooling Integration

**GitHub Actions Workflows:**
- **Automated Compatibility Testing:** 5 workflows for major Ethereum tools
- **PR Title Validation:** Enforced conventional commit standards
- **Security Scanning:** Integrated gitleaks for credential protection
- **Changelog Requirements:** Automated checks for feature documentation

---

##  Security & Stability

### Transaction Processing Reliability

**Fixed Issues:**
- **CometBlockResultByNumber:** Resolved regression when height is 0
- **Mempool Interruption:** Improved handling of mempool operations during block processing
- **Duplicate Case Protection:** Prevents empty execution blocks
- **Token Pair Queries:** Fixed handling of values containing slashes

### Enhanced Validation

**Improved Checks:**
- **Non-determinism Prevention:** Resolved state transition consistency issues
- **Parameter Validation:** Stronger validation using go-ethereum rules
- **Nonce Gap Handling:** Better error handling for transaction sequencing

---

##  Configuration Enhancements

### Previously Hard-Coded Parameters Now Configurable

**Mempool Pool Limits:**
```go
LegacyPoolConfig: &legacypool.Config{
    AccountSlots: 32,           // Was: 16 (hard-coded)
    GlobalSlots:  8192,         // Was: 4096 (hard-coded)  
    AccountQueue: 128,          // Was: 64 (hard-coded)
    GlobalQueue:  2048,         // Was: 1024 (hard-coded)
    Lifetime:     6*time.Hour,  // Was: 3h (hard-coded)
    PriceLimit:   2,            // Was: 1 (hard-coded)
    PriceBump:    15,           // Was: 10% (hard-coded)
}
```

**RPC Batch Processing:**
```toml
[json-rpc]
batch-request-limit = 1000        # New: DoS protection
batch-response-max-size = 25000000 # New: Memory management
enable-profiling = false          # New: Security control
```

**Block Gas Handling:**
```go
mempoolConfig := &evmmempool.EVMMempoolConfig{
    BlockGasLimit: 200_000_000, // Was: fixed at compile time
}
```

---

##  Documentation Updates

### New Documentation

- **[Migration Guide v0.4.x â†’ v0.5.0](../documentation/integration/migration-v0.4-to-v0.5):** Complete migration instructions
- **[Configuration Changes Guide](../documentation/integration/v0.5.0-configuration-changes):** Detailed parameter breakdown
- **[EIP-2935 Implementation](../documentation/evm-compatibility/eip-2935):** Historical block hash usage
- **[Performance Optimization](../documentation/concepts/performance):** Tuning and optimization guide

### Enhanced Documentation

- **[Mempool Configuration](../documentation/concepts/mempool):** Comprehensive configuration options
- **[EVM Compatibility](../documentation/evm-compatibility/overview):** v0.5.0 improvements summary  
- **[VM Module](../documentation/cosmos-sdk/modules/vm):** Updated parameter reference
- **[Testing Framework](../documentation/getting-started/tooling-and-resources/testing-and-fuzzing):** New compatibility testing

---

##  Migration Path

### Quick Migration Checklist

- [ ] **Update Genesis:** Remove `allow_unprotected_txs`, add `history_serve_window: 8192`
- [ ] **Update Dependencies:** Bump to `github.com/cosmos/evm v0.5.0`
- [ ] **Precompile Interfaces:** Cast concrete keepers to interfaces in precompile assembly
- [ ] **Mempool Configuration:** Update to configuration-based approach
- [ ] **Remove Global Mempool:** Pass mempool directly to JSON-RPC server
- [ ] **Test Migration:** Verify functionality with provided test suites

### Compatibility Testing

```bash
# Validate tool compatibility after migration
make test-compatibility

# Test specific tools
./scripts/tests_compatibility_foundry.sh
./scripts/tests_compatibility_hardhat.sh
./scripts/tests_compatibility_viem.sh

# Validate JSON-RPC compatibility  
cd tests/jsonrpc && ./scripts/run-compat-test.sh
```

---

##  Target Audiences

### Chain Developers

- **Enhanced Configurability:** Fine-tune mempool and performance parameters
- **Better Debugging:** Improved error messages and transaction analytics
- **Easier Integration:** Streamlined precompile interface requirements

### DApp Developers

- **Faster Development:** Optimized gas estimation reduces development iteration time
- **Better Tooling Support:** Comprehensive compatibility with all major Ethereum tools
- **Enhanced Features:** Access list optimization and historical block hash access

### Protocol Developers

- **Verifiable Randomness:** EIP-2935 enables new protocol designs
- **Custom Priorities:** Configurable transaction ordering for specialized use cases
- **Advanced Testing:** Comprehensive compatibility validation frameworks

---

##  Useful Links

- **[Migration Guide](../documentation/integration/migration-v0.4-to-v0.5):** Step-by-step upgrade instructions
- **[Configuration Reference](../documentation/integration/v0.5.0-configuration-changes):** All parameter changes
- **[GitHub Repository](https://github.com/cosmos/evm):** Source code and issue tracker
- **[Compatibility Testing](../documentation/getting-started/tooling-and-resources/testing-and-fuzzing):** Tool validation frameworks

---

##  What's Next

v0.5.0 establishes a strong foundation for future EVM compatibility improvements:

- **Enhanced EIP Support:** Continued implementation of latest Ethereum improvements
- **Performance Optimization:** Ongoing optimization of gas estimation and state management
- **Developer Tooling:** Expanded compatibility testing and development frameworks
- **Security Auditing:** Continuous security improvements and audit integration

For questions, bug reports, or feature requests, visit the [GitHub repository](https://github.com/cosmos/evm/issues) or join the discussion in [Cosmos Developer Discord](https://discord.gg/cosmosnetwork).