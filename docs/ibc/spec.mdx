---
title: IBC (v2) Spec
description: IBC Protocol Technical Specification
---

The IBC protocol enables interoperability through a standard set of components, interfaces, and a defined packet flow.

### Core Data Structures

The **`Packet`** is the primary data container for all cross-chain communication, wrapping one or more application-specific **`Payloads`**.

<CodeGroup>
  <Code title="packet.ts">
  ```typescript
  // The main data container sent between chains
  interface Packet {
      sourceClientId: bytes; // Client ID for the destination chain, as stored on the source chain
      destClientId: bytes;   // Client ID for the source chain, as stored on the destination chain
      sequence: uint64;      // Monotonically increasing nonce for ordering
      timeout: uint64;       // UNIX timestamp (seconds) on the destination chain when the packet expires
      data: [Payload];       // List of application payloads
  }

  // Application-specific data and routing info
  interface Payload {
      sourcePort: bytes;     // Identifies the sending application module
      destPort: bytes;       // Identifies the receiving application module
      version: string;       // App-specific version for data interpretation
      encoding: string;      // MIME-type string for decoding appData
      appData: bytes;        // Opaque application data
  }
  ```
  </Code>
</CodeGroup>

---

### Key Components

* **Client (ICS-02)**: An on-chain light client that verifies the state of a counterparty chain by verifying cryptographic proofs against a trusted consensus state. Key functions include `createClient`, `updateClient`, and the proof verifiers `verifyMembership` and `verifyNonMembership`.

* **Provable Store (ICS-24)**: The host chain must provide a key-value store capable of generating Merkle proofs for the existence and non-existence of data at specified paths. Commitments are stored at standardized paths to enable verification by counterparty chains.

| Value                 | Path Format                                    |
| :-------------------- | :--------------------------------------------- |
| **Packet Commitment** | `{sourceClientId}0x1{bigEndianUint64Sequence}` |
| **Packet Receipt** | `{destClientId}0x2{bigEndianUint64Sequence}`    |
| **Acknowledgement** | `{destClientId}0x3{bigEndianUint64Sequence}`    |

---

### Packet Lifecycle

1.  **`SendPacket` (Source Chain)**: The sending application calls the IBC handler with one or more `Payloads`. The handler constructs a `Packet`, generates a unique `sequence`, and stores a cryptographic commitment of the packet at the **Packet Commitment Path**.

2.  **`RecvPacket` (Destination Chain)**: A relayer submits the `Packet` and a `proof` of its commitment to the destination chain. The IBC handler uses the `destClientId` to select the correct client and verifies the proof. On success, it stores a `Receipt` at the **Packet Receipt Path** and executes the `OnRecvPacket` callback on the destination application.

3.  **`WriteAcknowledgement` (Destination Chain)**: The destination application returns an `Acknowledgement` (success data or an error value) from its `OnRecvPacket` callback. The handler stores a commitment of this `Acknowledgement` at the **Acknowledgement Commitment Path**.

4.  **`AcknowledgePacket` (Source Chain)**: A relayer delivers the `Acknowledgement` and its proof back to the source chain. The handler verifies the proof, deletes the original packet commitment, and executes the `OnAcknowledgePacket` callback on the sending application to finalize the transaction.

5.  **`TimeoutPacket` (Source Chain)**: If a packet is not acknowledged before its timeout, a relayer submits a non-existence proof for the **Packet Receipt**. The handler verifies this proof, deletes the packet commitment, and executes the `OnTimeoutPacket` callback on the sending application to revert the original transaction.

---

### Application Integration

* **Port Allocation (ICS-05)**: Applications must bind to one or more unique `portId`s. This ID is used in the `Payload` to route packets to the correct application module.

* **Application Callbacks (ICS-26)**: An IBC-enabled application **must** implement the following interface, which the core IBC handler calls at various stages of the packet lifecycle.
    * `OnRecvPacket(payload)`: Executed on the destination chain to process incoming data. It must return an acknowledgement.
    * `OnAcknowledgePacket(payload, acknowledgement)`: Executed on the source chain to handle the success or failure of a sent packet.
    * `OnTimeoutPacket(payload)`: Executed on the source chain to handle a packet that was not received, typically by reverting the original transaction.
